---
layout: post
title: 01-프로젝트-암호화관련 
tags: password 암호화 bookclips
categories: 프로젝트 bookclips
---    


[Bookclips](http://www.bookclips.xyz) 프로젝트를 진행하면서 암호화에 대해 생각하게 되었습니다.      
암호화의 내용과 개인적인 생각을 정리해 보겠습니다. 

[D2 안전한 패스워드 저장](http://d2.naver.com/helloworld/318732)을 참조하시면 이해가 빠를 것 같습니다.     

#### 개요      

지금까지 개인 프로젝트를 하면서 password를 암호화하지 않고 DB에 저장해뒀습니다. 
 문제를 제시하는 사람도 없었고 암호화에 대한 개념을 모르고있었기 때문인데, 그러던 중, [D2 안전한 패스워드 저장](http://d2.naver.com/helloworld/318732)의 포스팅을 보고 한번 적용해 보고 싶다는 생각에 암호화를 공부하고 적용해봤습니다.  

> D2에서는 단순Text를 저장하는것을 '범죄를 저지르는 것이나 다름없다.'라고 표현한다.     

#### 단방향 과 양방향 Hash 함수     

단방향 Hash 함수란 message를 암호화한 후, 암호화된 것으론 원본 message를 알 수없는 것을 말합니다.  주로 password를 저장할 때 사용하고 실제로 Bookclips 프로젝트의 password를 단방향 hash 함수[BCrypt(java::jbcrypt)]로 진행하고 있습니다.    

> 직접 Hash 함수를 통해 구현하지 않은 이유는 밑에 서술하겠습니다.     


양방향 Hash 함수란 암호화 된 값을 원본 message로 복호화 가능한 함수를 말합니다. 양방향 Hash함수는 크게 대칭키, 비대칭키가 존재하는데, 하나의 key로 암호화/복호화가 가능한 경우를 대칭키, 공개키와 비공개키를 이용하여 암호화/복호화를 수행하는 경우를 비대칭키라 합니다. 
Bookclips 프로젝트에서 memo 기능을 JAVA 에서 제공하는 Cipher class를 사용하여 구현했습니다. (대칭키를 사용)    
특별히 이유가 있어서 memo에 적용한것은 아니고 한번 대칭키를 사용해보고 싶어서...     
     
> Https는  대칭키와 비대칭키를 섞어 사용하는것으로 알고있습니다.  ::  [생활코딩 HTTPS](https://opentutorials.org/course/228/4894)를 참조.    

#### Hash 함수의 문제점과 해결방안.   

###### 속도    
    
Hash 함수는 원래 암호화를 위해서 만들어진게 아니라 빠른 검색을 위해서 만들었다고합니다.
때문에 공격자는 빠른속도로 입력값과 암호화된 값을 비교할수 있게되는데,  D2에서는 오히려 빠른 인증이 사용자보다 공격자에게 편의를 제공한다고 말합니다.
사용자는 인증을 위해서 1 초 이상의 시간을 소모해도 불편함을 느끼지 않기때문이라고합니다.  

> 빠른 인증은 오히려 공격자에게 편의를 제공합니다.   

###### 인식가능성    

+(Hash 함수는 동일한 Message가 항상 같은 값을 가진다)       
동일한 message 가 항상 같은 값을 가진다면, 공격자는 message와 암호화된 값으로 이루어진 '레인보우 테이블(rainbow table)'을 이용하여 원본 데이터를 알아 낼 수 있습니다. 

이를 방지하기 위해서 솔팅(salting) 이라는 방법을 사용하는데, 간단하게 말해서 암호화할때 임의의 문자열을 추가하여 암호화 하는 방식을 의미합니다.   
> 원본 message에 특정 salt값을 조합하여 암호화를 진행하는 방식     

이와 같은 방법을 사용할 경우, 공격자가 원본을 알기도 힘들고 사용자가 다른 사이트에 동일한 password를 사용한다 하더라도 암호화된 결과가 다르므로 문제가 크게 개선됩니다.  

또한 이러한 솔팅을 여러번 반복하여 암호화를 진행하는 '키 스트레칭(key stretching)' 방법을 사용하기도 합니다.    


D2에서는 이러한 방법을 알고 있더라도 암호화시에는 검증된 암호화 시스템을 사용하길 권장하는데, 전 그중 bcrypt 을 사용하여 password를 암호화 하고있습니다.   

> 추후 내부적으로 어떻게 작동하는지는 좀더 공부를 해봐야겠네요.    

> (+) 06 30 mysql 이나 DBMS 에서 PASSWORD()등의 암호화하는 함수를 제공한다고 합니다.        
> 굳이 서버쪽에서 암호화를 진행하지 않아도 될것 같습니다.    


2017 05 23    
lusiue@gmail.com
